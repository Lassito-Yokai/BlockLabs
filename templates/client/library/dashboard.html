{% extends 'client/base.html' %}
{% load static %}

{% block title %}Library - Documents des Métadonneurs{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/library.css' %}">
{% endblock %}

{% block content %}
<div class="library-dashboard">
    <!-- Header -->
    <div class="page-header">
        <div class="header-content">
            <div class="header-info">
                <h1>Bibliothèque de Documents</h1>
                <p>Documents uploadés et validés par les métadonneurs</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="location.href='{% url 'client:library:document_list' %}'">
                    <i class="material-icons">library_books</i>
                    Parcourir Documents
                </button>
            </div>
        </div>
    </div>

    <!-- Statistiques -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon blue">
                <i class="material-icons">library_books</i>
            </div>
            <div class="stat-content">
                <h3>{{ total_documents }}</h3>
                <p>Documents validés</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon orange">
                <i class="material-icons">schedule</i>
            </div>
            <div class="stat-content">
                <h3>{{ pending_validation }}</h3>
                <p>En attente de validation</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon green">
                <i class="material-icons">person</i>
            </div>
            <div class="stat-content">
                <h3>{{ total_metadonneurs }}</h3>
                <p>Métadonneurs actifs</p>
            </div>
        </div>
        
        <div class="stat-card">
            <div class="stat-icon purple">
                <i class="material-icons">category</i>
            </div>
            <div class="stat-content">
                <h3>{{ document_type_stats|length }}</h3>
                <p>Types de documents</p>
            </div>
        </div>
    </div>

    <!-- Contenu principal -->
    <div class="dashboard-content">
        <!-- Documents récents -->
        <div class="dashboard-section">
            <div class="section-header">
                <h2>Documents récents</h2>
                <a href="{% url 'client:library:document_list' %}" class="view-all">Voir tout</a>
            </div>
            
            <div class="documents-list">
                {% for document in recent_documents %}
                <div class="document-card" onclick="location.href='{% url 'client:library:document_detail' document.pk %}'">
                    <div class="document-icon">
                        <i class="material-icons red">picture_as_pdf</i>
                    </div>
                    
                    <div class="document-content">
                        <h4>{{ document.title|default:"Sans titre"|truncatechars:80 }}</h4>
                        <div class="document-meta">
                            <span class="meta-item">
                                <i class="material-icons">person</i>
                                {{ document.owner.username|default:"Anonyme" }}
                            </span>
                            <span class="meta-item">
                                <i class="material-icons">calendar_today</i>
                                {{ document.created_at|date:"d/m/Y" }}
                            </span>
                            {% if document.language %}
                            <span class="meta-item">
                                <i class="material-icons">language</i>
                                {{ document.language }}
                            </span>
                            {% endif %}
                        </div>
                        
                        {% if document.doc_type %}
                        <div class="document-tags">
                            <span class="tag">{{ document.doc_type }}</span>
                            {% if document.country %}
                            <span class="tag">{{ document.country }}</span>
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="document-actions">
                        <span class="status validated">Validé</span>
                    </div>
                </div>
                {% empty %}
                <div class="empty-state">
                    <i class="material-icons">library_books</i>
                    <h3>Aucun document disponible</h3>
                    <p>Les documents uploadés et validés par les métadonneurs apparaîtront ici.</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Statistiques par type et pays -->
        <div class="dashboard-grid">
            <div class="dashboard-section">
                <div class="section-header">
                    <h2>Par type de document</h2>
                </div>
                
                <div class="category-stats">
                    {% for type_stat in document_type_stats %}
                    <div class="category-item">
                        <div class="category-color" style="background-color: #3498db;"></div>
                        <span class="category-name">{{ type_stat.doc_type }}</span>
                        <span class="category-count">{{ type_stat.count }}</span>
                    </div>
                    {% empty %}
                    <p class="no-data">Aucun type de document détecté</p>
                    {% endfor %}
                </div>
            </div>
            
            <div class="dashboard-section">
                <div class="section-header">
                    <h2>Par pays</h2>
                </div>
                
                <div class="authority-stats">
                    {% for country_stat in country_stats %}
                    <div class="authority-item">
                        <span class="authority-code">{{ country_stat.country|slice:":3"|upper }}</span>
                        <span class="authority-name">{{ country_stat.country }}</span>
                        <span class="authority-count">{{ country_stat.count }}</span>
                    </div>
                    {% empty %}
                    <p class="no-data">Aucun pays détecté</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Search Bar flottante -->
    <div class="floating-search">
        <div class="search-container">
            <input type="text" id="global-search" placeholder="Rechercher un document..." />
            <i class="material-icons">search</i>
        </div>
        <div id="search-results" class="search-results"></div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/library.js' %}"></script>
{% endblock %}